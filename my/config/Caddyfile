{
  user www-data
}

:${PORT}
# ssl {
#   cert /etc/ssl/certs/example.com.crt
#   key /etc/ssl/private/example.com.key
# }
root * /app/web
file_server browse

log {
  # 禁用自动保存
  autosave off

  # 禁用初始配置日志
  initial_config off

  # 禁用 TLS 清理日志
  tls_storage {
    clean_on_stop off
  }
}

header {
  X-Robots-Tag none
  X-Content-Type-Options nosniff
  X-Frame-Options DENY
  Referrer-Policy no-referrer-when-downgrade
}

@websocket_xray {
  header Connection *Upgrade*
  header Upgrade websocket
  path /${VMESS_WSPATH}|/${VLESS_WSPATH}
}
reverse_proxy @websocket_xray localhost:${V_PORT} {
  header_up Host ${config.json.inbounds[0].id}
}

# 代理其他服务
handle_path /app {
  file_server {
   root /
  }
}

# 主页
handle / {
  file_server {
   root /app/web
   index index.html
  }
}
